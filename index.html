<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oil & Gas Daily Progress Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid #ff6b35;
        }

        .header h1 {
            color: #1e3c72;
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #1e3c72;
            font-size: 0.9rem;
        }

        input, select, button {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        button {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-block;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(42, 82, 152, 0.3);
        }

        .main-content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #1e3c72;
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 700;
            border-bottom: 3px solid #ff6b35;
            padding-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .data-table tr:hover {
            background: #e3f2fd;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
        }

        .loading {
            display: none;
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #c62828;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #2e7d32;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ¢Ô∏è Oil & Gas Daily Progress Dashboard</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>Upload CSV Data</label>
                <div class="file-input-wrapper">
                    <input type="file" id="csvFile" accept=".csv" />
                    <label for="csvFile" class="file-input-label">Choose CSV File</label>
                </div>
            </div>
            
            <div class="control-group">
                <label>Select Date</label>
                <input type="date" id="selectedDate">
            </div>
            
            <div class="control-group">
                <label>Date Range</label>
                <select id="dateRange">
                    <option value="single">Single Date</option>
                    <option value="week">Past Week</option>
                    <option value="month">Past Month</option>
                    <option value="quarter">Past Quarter</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Action</label>
                <button onclick="loadData()">Load Data</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div id="loadingDiv" class="loading">Loading data...</div>
        <div id="errorDiv" class="error" style="display: none;"></div>
        <div id="successDiv" class="success" style="display: none;"></div>
        
        <div id="dashboardContent" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalProduction">0</div>
                    <div class="stat-label">Total Production</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeWells">0</div>
                    <div class="stat-label">Active Wells</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="efficiency">0%</div>
                    <div class="stat-label">Efficiency</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="downtime">0h</div>
                    <div class="stat-label">Downtime</div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <h3>üìä Production Trends</h3>
                    <div class="chart-container">
                        <canvas id="productionChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>‚ö° Performance Metrics</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>üîß Equipment Status</h3>
                    <div class="chart-container">
                        <canvas id="equipmentChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà Daily Summary</h3>
                    <div id="summaryTable"></div>
                </div>
            </div>

            <div class="card" style="margin-top: 25px;">
                <h3>üìã Detailed Data View</h3>
                <div id="dataTableContainer"></div>
            </div>
        </div>
    </div>

    <script>
        let rawData = [];
        let filteredData = [];
        let charts = {};

        // Set today's date as default
        document.getElementById('selectedDate').valueAsDate = new Date();

        // File upload handler
        document.getElementById('csvFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        rawData = results.data;
                        showSuccess(`Loaded ${rawData.length} records from CSV file`);
                        filterAndDisplayData();
                    },
                    error: function(error) {
                        showError(`Error parsing CSV: ${error.message}`);
                    }
                });
            }
        });

        // Load data from the public Google Sheets URL
        function loadData() {
            const publicSheetsUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS4gLqzfOxQybJBYdtMmtBJdYWb1EPkUcC7p-py4kiEaFO0Yre3gCtpetkg7X-XY19dVI-6dTydkJYm/pub?output=csv';
            
            showLoading(true);
            
            Papa.parse(publicSheetsUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    showLoading(false);
                    rawData = results.data;
                    showSuccess(`Successfully loaded ${rawData.length} records from Google Sheets`);
                    filterAndDisplayData();
                },
                error: function(error) {
                    showLoading(false);
                    showError(`Error loading data from Google Sheets: ${error.message}`);
                }
            });
        }

        function filterAndDisplayData() {
            const selectedDate = document.getElementById('selectedDate').value;
            const dateRange = document.getElementById('dateRange').value;

            if (!rawData.length) {
                showError('No data loaded. Please load data first.');
                return;
            }

            // Filter data based on selected criteria
            filteredData = filterDataByDate(rawData, selectedDate, dateRange);
            
            if (filteredData.length === 0) {
                showError('No data found for the selected date/range.');
                return;
            }

            displayDashboard();
        }

        function filterDataByDate(data, selectedDate, range) {
            if (!selectedDate) return data;

            const selected = new Date(selectedDate);
            
            return data.filter(row => {
                // Try to find date column (common names)
                const dateField = findDateField(row);
                if (!dateField) return true;

                const rowDate = new Date(row[dateField]);
                if (isNaN(rowDate)) return false;

                switch (range) {
                    case 'single':
                        return rowDate.toDateString() === selected.toDateString();
                    case 'week':
                        const weekAgo = new Date(selected);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return rowDate >= weekAgo && rowDate <= selected;
                    case 'month':
                        const monthAgo = new Date(selected);
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        return rowDate >= monthAgo && rowDate <= selected;
                    case 'quarter':
                        const quarterAgo = new Date(selected);
                        quarterAgo.setMonth(quarterAgo.getMonth() - 3);
                        return rowDate >= quarterAgo && rowDate <= selected;
                    default:
                        return true;
                }
            });
        }

        function findDateField(row) {
            const dateFields = ['date', 'Date', 'DATE', 'day', 'Day', 'timestamp', 'Timestamp', 'time', 'Time'];
            for (let field of dateFields) {
                if (row[field]) return field;
            }
            return Object.keys(row)[0]; // Default to first column
        }

        function displayDashboard() {
            document.getElementById('dashboardContent').style.display = 'block';
            
            // Calculate and display statistics
            calculateStats();
            
            // Create charts
            createCharts();
            
            // Display data table
            displayDataTable();
        }

        function calculateStats() {
            if (!filteredData.length) return;

            const keys = Object.keys(filteredData[0]);
            
            // Try to find production-related columns
            const productionField = keys.find(k => 
                k.toLowerCase().includes('production') || 
                k.toLowerCase().includes('output') ||
                k.toLowerCase().includes('volume')
            );
            
            const wellsField = keys.find(k => 
                k.toLowerCase().includes('well') || 
                k.toLowerCase().includes('unit')
            );
            
            const efficiencyField = keys.find(k => 
                k.toLowerCase().includes('efficiency') || 
                k.toLowerCase().includes('performance')
            );
            
            const downtimeField = keys.find(k => 
                k.toLowerCase().includes('downtime') || 
                k.toLowerCase().includes('maintenance')
            );

            // Calculate totals
            let totalProduction = 0;
            let activeWells = 0;
            let avgEfficiency = 0;
            let totalDowntime = 0;

            filteredData.forEach(row => {
                if (productionField && !isNaN(parseFloat(row[productionField]))) {
                    totalProduction += parseFloat(row[productionField]);
                }
                if (wellsField && row[wellsField]) {
                    activeWells++;
                }
                if (efficiencyField && !isNaN(parseFloat(row[efficiencyField]))) {
                    avgEfficiency += parseFloat(row[efficiencyField]);
                }
                if (downtimeField && !isNaN(parseFloat(row[downtimeField]))) {
                    totalDowntime += parseFloat(row[downtimeField]);
                }
            });

            avgEfficiency = filteredData.length > 0 ? avgEfficiency / filteredData.length : 0;

            document.getElementById('totalProduction').textContent = totalProduction.toLocaleString();
            document.getElementById('activeWells').textContent = activeWells.toLocaleString();
            document.getElementById('efficiency').textContent = avgEfficiency.toFixed(1) + '%';
            document.getElementById('downtime').textContent = totalDowntime.toFixed(1) + 'h';
        }

        function createCharts() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};

            if (!filteredData.length) return;

            const keys = Object.keys(filteredData[0]);
            const labels = filteredData.map((row, index) => `Entry ${index + 1}`);

            // Production Chart
            const productionData = {
                labels: labels,
                datasets: [{
                    label: 'Production',
                    data: filteredData.map(row => {
                        const productionField = keys.find(k => 
                            k.toLowerCase().includes('production') || 
                            k.toLowerCase().includes('output')
                        );
                        return productionField ? parseFloat(row[productionField]) || 0 : 0;
                    }),
                    borderColor: '#ff6b35',
                    backgroundColor: 'rgba(255, 107, 53, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            };

            charts.production = new Chart(document.getElementById('productionChart'), {
                type: 'line',
                data: productionData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Performance Chart (Doughnut)
            const performanceData = {
                labels: ['Operational', 'Maintenance', 'Downtime'],
                datasets: [{
                    data: [70, 20, 10], // Sample data - replace with actual calculations
                    backgroundColor: ['#2a5298', '#ff6b35', '#f7931e'],
                    borderWidth: 0
                }]
            };

            charts.performance = new Chart(document.getElementById('performanceChart'), {
                type: 'doughnut',
                data: performanceData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Equipment Status Chart (Bar)
            const equipmentData = {
                labels: ['Online', 'Offline', 'Maintenance'],
                datasets: [{
                    data: [85, 10, 5], // Sample data
                    backgroundColor: ['#2a5298', '#ff6b35', '#f7931e'],
                    borderRadius: 8
                }]
            };

            charts.equipment = new Chart(document.getElementById('equipmentChart'), {
                type: 'bar',
                data: equipmentData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function displayDataTable() {
            if (!filteredData.length) {
                document.getElementById('dataTableContainer').innerHTML = 
                    '<div class="no-data">No data to display</div>';
                return;
            }

            const keys = Object.keys(filteredData[0]);
            
            let tableHTML = '<table class="data-table"><thead><tr>';
            keys.forEach(key => {
                tableHTML += `<th>${key}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            filteredData.slice(0, 20).forEach(row => { // Show only first 20 rows
                tableHTML += '<tr>';
                keys.forEach(key => {
                    tableHTML += `<td>${row[key] || '-'}</td>`;
                });
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';
            
            if (filteredData.length > 20) {
                tableHTML += `<p style="text-align: center; margin-top: 15px; color: #666;">
                    Showing first 20 of ${filteredData.length} records</p>`;
            }

            document.getElementById('dataTableContainer').innerHTML = tableHTML;

            // Create summary
            const summaryHTML = `
                <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 15px; color: #1e3c72;">üìä Data Summary</h4>
                    <p><strong>Total Records:</strong> ${filteredData.length}</p>
                    <p><strong>Date Range:</strong> ${document.getElementById('dateRange').value}</p>
                    <p><strong>Selected Date:</strong> ${document.getElementById('selectedDate').value || 'All dates'}</p>
                    <p><strong>Columns:</strong> ${keys.join(', ')}</p>
                </div>
            `;
            document.getElementById('summaryTable').innerHTML = summaryHTML;
        }

        function showLoading(show) {
            document.getElementById('loadingDiv').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            document.getElementById('errorDiv').textContent = message;
            document.getElementById('errorDiv').style.display = 'block';
            setTimeout(() => {
                document.getElementById('errorDiv').style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            document.getElementById('successDiv').textContent = message;
            document.getElementById('successDiv').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successDiv').style.display = 'none';
            }, 3000);
        }

        // Event listeners
        document.getElementById('selectedDate').addEventListener('change', filterAndDisplayData);
        document.getElementById('dateRange').addEventListener('change', filterAndDisplayData);

        // Load data automatically when page loads
        window.addEventListener('load', function() {
            loadData();
        });
    </script>
</body>
</html>
